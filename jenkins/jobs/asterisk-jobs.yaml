- job-template:
    name: 'periodic-{name}-{branch}'
    node: 'centos || debian'
    concurrent: true

    wrappers:
        - timeout:
            timeout: 300
            timeout-var: 'BUILD_TIMEOUT'
            fail: true
        - timestamps

    builders:
        - node-git-prep
        - gerrit-git-prep:
            branch: '{branch}'
            project: '{name}'
        - prep-testsuite
        - run-asterisk-unittests
        - run-testsuite

    publishers:
        - publish-asterisk-unittests:
            project-name: '{name}'
        - publish-asterisk-testsuite


- job-template:
    name: 'periodic-ref_debug-{name}-{branch}'
    node: 'centos || debian'
    concurrent: true

    wrappers:
        - timeout:
            timeout: 300
            timeout-var: 'BUILD_TIMEOUT'
            fail: true
        - timestamps

    builders:
        - node-git-prep
        - gerrit-git-prep:
            branch: '{branch}'
            project: '{name}'
        - prep-testsuite
        - run-asterisk-unittests
             build-asterisk-params: '-e REF_DEBUG'
        - run-testsuite
             ref-debug: '1'

    publishers:
        - publish-asterisk-unittests:
            project-name: '{name}'
        - publish-asterisk-testsuite


- job-template:
    name: 'check-{name}'
    node: 'centos || debian'
    concurrent: true

    wrappers:
        - timeout:
            timeout: 60
            timeout-var: 'BUILD_TIMEOUT'
            fail: true
        - timestamps

    builders:
        - node-git-prep
        - gerrit-git-prep
        - run-asterisk-unittests

    publishers:
        - publish-asterisk-unittests:
            project-name: '{name}'


- job-template:
    name: 'gate-{name}'
    node: 'centos || debian'
    concurrent: true

    wrappers:
        - timeout:
            timeout: 60
            timeout-var: 'BUILD_TIMEOUT'
            fail: true
        - timestamps

    builders:
        - node-git-prep
        - gerrit-git-prep
        - run-asterisk-unittests

    publishers:
        - publish-asterisk-unittests:
            project-name: '{name}'


- job-template:
    name: 'gate-{name}-channel-drivers'
    node: 'centos || debian'
    concurrent: true

    wrappers:
        - timeout:
            timeout: 180
            timeout-var: 'BUILD_TIMEOUT'
            fail: true
        - timestamps

    builders:
        - node-git-prep
        - gerrit-git-prep
        - build-asterisk:
            build-asterisk-params: '-v -e DO_CRASH'
        - prep-testsuite
        - run-testsuite:
            testsuite-params: '-t tests/channels'

    publishers:
        - publish-asterisk-testsuite


- job-template:
    name: 'gate-{name}-external-mwi'
    node: 'centos || debian'
    concurrent: true

    wrappers:
        - timeout:
            timeout: 60
            timeout-var: 'BUILD_TIMEOUT'
            fail: true
        - timestamps

    builders:
        - node-git-prep
        - gerrit-git-prep
        - build-asterisk:
            build-asterisk-params: '-v -d app_voicemail -e res_mwi_external -e res_mwi_external_ami -e res_stasis_mailbox -e DO_CRASH'
        - prep-testsuite
        - run-testsuite:
            testsuite-params: '-g mwi_external'

    publishers:
        - publish-asterisk-testsuite


- job-template:
    name: 'gate-{name}-ari'
    node: 'centos || debian'
    concurrent: true

    wrappers:
        - timeout:
            timeout: 60
            timeout-var: 'BUILD_TIMEOUT'
            fail: true
        - timestamps

    builders:
        - node-git-prep
        - gerrit-git-prep
        - build-asterisk:
            build-asterisk-params: '-v -e app_voicemail -e app_directory -e test_voicemail_api -e FILE_STORAGE -e DO_CRASH'
        - prep-testsuite
        - run-testsuite:
            testsuite-params: '-g ARI'

    publishers:
        - publish-asterisk-testsuite


- job-group:
    name: asterisk-jobs
    jobs:
        - 'check-{name}'
        - 'gate-{name}'
        - 'gate-{name}-channel-drivers'
        - 'gate-{name}-external-mwi'
        - 'gate-{name}-ari'
        - 'periodic-{name}-{branch}'
